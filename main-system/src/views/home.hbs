<div id="main-content-wp" class="home-page clearfix">
    <div class="wp-inner">
        <div class="main-content fl-right">
            <div class="section" id="slider-wp">
                <div class="section-detail">
                    <div class="item">
                        <img src="images/slider-01.png" alt="">
                    </div>
                    <div class="item">
                        <img src="images/slider-01.png" alt="">
                    </div>
                    <div class="item">
                        <img src="images/slider-01.png" alt="">
                    </div>
                </div>
            </div>
            <div class="section" id="support-wp">
                <div class="section-detail">
                    <ul class="list-item clearfix">
                        <li>
                            <div class="thumb">
                                <img src="images/icon-1.png">
                            </div>
                            <h3 class="title">Miễn phí vận chuyển</h3>
                            <p class="desc">Tới tận tay khách hàng</p>
                        </li>
                        <li>
                            <div class="thumb">
                                <img src="images/icon-2.png">
                            </div>
                            <h3 class="title">Tư vấn 24/7</h3>
                            <p class="desc">1900.9999</p>
                        </li>
                        <li>
                            <div class="thumb">
                                <img src="images/icon-3.png">
                            </div>
                            <h3 class="title">Tiết kiệm hơn</h3>
                            <p class="desc">Với nhiều ưu đãi cực lớn</p>
                        </li>
                        <li>
                            <div class="thumb">
                                <img src="images/icon-4.png">
                            </div>
                            <h3 class="title">Thanh toán nhanh</h3>
                            <p class="desc">Hỗ trợ nhiều hình thức</p>
                        </li>
                        <li>
                            <div class="thumb">
                                <img src="images/icon-5.png">
                            </div>
                            <h3 class="title">Đặt hàng online</h3>
                            <p class="desc">Thao tác đơn giản</p>
                        </li>
                    </ul>
                </div>
            </div>
            {{!-- <div class="section" id="feature-product-wp">
                <div class="section-head">
                    <h3 class="section-title">Sản phẩm nổi bật</h3>
                </div>
                <div class="section-detail">
                    <ul class="list-item">
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        <li>
                            <a href="product/detail/1" title="" class="thumb">
                                <img src="/images/img-pro-01.png">
                            </a>
                            <a href="product/detail/1" title="" class="product-name">Laptop Lenovo IdeaPad 120S</a>
                            <div class="price">
                                <span class="new">5.190.000đ</span>
                                <span class="old">6.190.000đ</span>
                            </div>
                            <div class="action clearfix">
                                <a href="/add_cart" title="" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div> --}}
            {{#each get4ProductOfEachCategory}}
            <div class="section" id="list-product-wp">
                <div class="section-head">
                    <h3 class="section-title">{{this.CategoryName}}</h3>
                </div>
                <div class="section-detail">
                    {{#if this.products}}
                    <ul class="list-item clearfix">
                        {{#each this.products}}
                        <li>
                            <a href="product/detail/{{this.ProductID}}" title="" class="thumb">
                                {{#if this.ImageURL}}
                                <img style="width:190px;height:190px;" src="/images/products/{{this.ProductID}}.jpg">
                                {{else}}
                                <img src="images/img-pro-01.png">
                                {{/if}}
                            </a>
                            <a href="product/detail/{{this.ProductID}}" title=""
                                class="product-name text-truncate">{{this.ProductName}}</a>
                            <div class="price">
                                <span class="new" style="font-size:13px;">{{formatPrice this.Price}}</span>
                                {{#if this.Discount}}
                                <span class="old" style="font-size:13px;">{{calculateOldPrice this.Price this.Discount}}</span>
                                {{/if}}
                            </div>
                            <div class="action clearfix">
                                <a role="button" onclick="addToCart('{{this.ProductID}}', 1)" title="Thêm giỏ hàng" class="add-cart fl-left">Thêm giỏ hàng</a>
                                <a href="/checkout" title="Mua ngay" class="buy-now fl-right">Mua ngay</a>
                            </div>
                        </li>
                        {{/each}}
                    </ul>
                    {{else}}
                    <p>Không có sản phẩm trong danh mục này.</p>
                    {{/if}}
                </div>
            </div>
            {{/each}}
        </div>
        {{> sidebar}}
    </div>
</div>
<!--Modal thông báo thành công/thất bại khi thêm sản phẩm vào giỏ hàng-->
<div class="modal fade" id="modalAddToCart" tabindex="-1" role="dialog" aria-labelledby="modalAddToCartLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div id="modalAddToCartLabel" class="modal-header">
                <h5 class="modal-title">Thông báo</h5>
            </div>
            <div class="modal-body">
                <p id="modalAddToCartMessage"></p>
            </div>
            <div class="modal-footer">
                <a role="button" type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeModal()">Đóng thông báo</a>
                <a href="/cart" class="btn btn-primary">Xem giỏ hàng</a>
            </div>
        </div>
    </div>
</div>
<script>
    function formatPrice(price) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
    }


    function calculateOldPrice(price, discount) {
        return formatPrice(price + (price * discount / 100))
    }
</script>
<script>
    //Đóng modal thông báo sau 3s
    $(document).ready(function () {
        setTimeout(function () {
            $('#modalAddToCart').modal('hide');
        }, 3000);
    });
    
    function closeModal() {
        $('#modalAddToCart').modal('hide');
    }

</script>

<script>
    function addToCart(productId, quantity) {
        $.ajax({
            url: '/cart/add',
            method: 'POST',
            data: {
                productId: productId,
                quantity: quantity
            },
            success: function (response) {
                $('#modalAddToCartMessage').html("Thêm sản phẩm vào giỏ hàng thành công");
                $('#modalAddToCart').modal('show');
            },
            error: function (error) {
                $('#modalAddToCartMessage').html("Thêm sản phẩm vào giỏ hàng thất bại");
                $('#modalAddToCart').modal('show');
            }
        });
    }
</script>